# Multi-Agent 流式输出 UI 设计规划

## 问题现状

当前的流式输出展示存在以下问题：

1. **信息层级混乱**：各个 agent 的输出、工具调用、中间状态混在一起，难以区分重点
2. **时间线不清晰**：多个 agent 执行完后，上一个 agent 的结果如何展示不明确
3. **动线不直观**：用户不知道在哪里看什么信息（主流程 vs 详细日志）
4. **视觉噪音过多**：大量技术细节（tool_call、state_update）干扰用户体验

## 核心设计原则

### 1. 信息分层原则
```
用户核心关注 (主对话区)
├── 最终交付物（文案 + 图片）
├── 关键决策点（HITL 确认）
└── 重要里程碑（Brief 完成、版式规划完成等）

技术执行细节 (侧边栏/可折叠)
├── Agent 执行顺序
├── 工具调用日志
└── 状态变化记录
```

### 2. 时间线清晰原则
- 已完成的 agent 输出应该「归档」为简洁的卡片
- 正在执行的 agent 显示实时进度
- 下一个 agent 开始时，上一个 agent 自动收起

### 3. 视觉优先级原则
```
高优先级（始终可见）
- 当前正在生成的内容（文案/图片）
- HITL 确认对话框
- 工作流进度条

中优先级（可折叠查看）
- 研究过程（search_notes 结果）
- Brief/版式规划详情
- 质量评分

低优先级（侧边栏隐藏）
- Tool call/result 日志
- State update 事件
- Supervisor 路由决策
```

---

### 侧边栏布局（右侧 20-30%，可切换显示）

```
┌─────────────────────────────────┐
│ 执行详情 [可切换关闭]            │
├─────────────────────────────────┤
│                                 │
│ 🔍 筛选：                        │
│ [全部] [Agent] [工具] [状态]    │
│                                 │
│ ─────────────────────────────  │
│                                 │
│ 1. Supervisor 路由              │
│    └─ NEXT: brief_compiler     │
│       时间: 10:23:45            │
│                                 │
│ 2. Brief Compiler Agent         │
│    ├─ 开始: 10:23:46            │
│    ├─ 工具: analyze_intent      │
│    └─ 完成: 10:23:52 (6s)      │
│                                 │
│ 3. Research Evidence Agent      │
│    ├─ 开始: 10:23:52            │
│    ├─ 工具: search_notes        │
│    │   └─ 搜索到 15 条结果      │
│    │       [查看详情 →]         │
│    └─ 完成: 10:24:10 (18s)     │
│                                 │
│ [滚动查看更多...]               │
│                                 │
└─────────────────────────────────┘
```

---

## 实际工作流程（按时间顺序）

```
用户请求 → Brief编译 → 研究收集 → 文案生成 → [HITL确认]
  → 图片规划 → [HITL确认] → 图片生成 → 审核评分 → 最终交付
```

### 核心 UI 设计原则（基于 Vercel Guidelines）

1. **当前步骤永远在视觉中央**
   - 使用 `scrollIntoView({ behavior: 'smooth', block: 'center' })` 自动居中
   - 当前步骤高亮显示（`ring-2 ring-blue-500`）

2. **已完成步骤自动折叠**
   - 完成后 500ms 延迟后自动折叠为精简卡片
   - 使用 `transform` + `opacity` 动画（遵循 `prefers-reduced-motion`）
   - 折叠后显示摘要信息（✓ Brief 完成、✓ 文案生成等）

3. **进行中步骤实时更新**
   - 使用 `aria-live="polite"` 通知状态变化
   - 加载状态统一用 `…` 而非三个点 `...`
   - 进度条使用 `transform: scaleX()` 而非 `width` 动画

4. **HITL 确认始终置顶**
   - 出现时使用 `position: sticky; top: 64px;` 吸顶
   - 配合轻微 `animate-pulse` 吸引注意（可通过 `prefers-reduced-motion` 禁用）

---

## 详细 UI 布局设计

### 主对话区布局（左侧 70-80%，自动滚动管理）

#### 状态 1: 用户提交请求

```
┌─────────────────────────────────────────────────────────┐
│ [顶部进度条: 0%]                                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  👤 用户消息                                             │
│  帮我写一篇关于春游的小红书笔记                            │
│                                                         │
│  ────────────────────────────────────────────────────  │
│                                                         │
│  🔄 正在处理中…                                          │
│  [旋转加载动画 - transform: rotate()]                    │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 状态 2: Brief 编译 + 研究阶段（当前焦点）

```
┌─────────────────────────────────────────────────────────┐
│ [顶部进度条: 20%] 当前：研究证据收集                        │
├─────────────────────────────────────────────────────────┤
│  👤 用户: 帮我写一篇关于春游的小红书笔记                    │
│                                                         │
│  ── 🤖 AI ──────────────────────────────────────────   │
│                                                         │
│  ✓ Brief 编译完成 [已折叠]                               │
│    └─ 目标：春游攻略 | 受众：年轻女性 [展开▼]             │
│                                                         │
│  📋 正在研究相关内容… [当前步骤 - ring-2 ring-blue-500]   │
│  ┌───────────────────────────────────────────────────┐ │
│  │ [实时更新 - aria-live="polite"]                     │ │
│  │ ▸ 搜索到 15 篇相关笔记                              │ │
│  │ ▸ 正在分析热门标签…                                 │ │
│  │ ▸ 提取爆款标题规律…                                 │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  [自动滚动至此，保持视觉中央]                             │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 状态 3: 文案生成完成，等待 HITL 确认（吸顶）

```
┌─────────────────────────────────────────────────────────┐
│ [顶部进度条: 40%] 等待用户确认                             │
├─────────────────────────────────────────────────────────┤
│  👤 用户: 帮我写一篇关于春游的小红书笔记                    │
│                                                         │
│  ✓ Brief 编译完成 [折叠]                                 │
│  ✓ 研究收集完成 [折叠] - 15篇笔记，20个热门标签            │
│                                                         │
│  ── 🤖 文案已生成 ──────────────────────────────────    │
│                                                         │
│  📝 ContentCard [当前焦点 - 居中显示]                     │
│  ┌───────────────────────────────────────────────────┐ │
│  │ 春天就该野一点！上海周边超适合春游的宝藏公园         │ │
│  │                                                     │ │
│  │ 姐妹们，今天分享一个我偶然发现的春游宝地🌸          │ │
│  │ 📍 地点：顾村公园                                   │ │
│  │ 🎫 门票：20元（樱花季可能上涨）                     │ │
│  │ 🚇 交通：地铁7号线顾村公园站                        │ │
│  │                                                     │ │
│  │ [完整文案内容，支持预览滚动]                         │ │
│  │                                                     │ │
│  │ 🏷️ #春游 #上海周边 #踏青 #顾村公园                 │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │
│  ┃ 🤖 需要确认 [sticky top-16, animate-pulse]        ┃ │
│  ┃                                                    ┃ │
│  ┃ 文案已生成，是否继续生成图片？                      ┃ │
│  ┃                                                    ┃ │
│  ┃ ○ 继续生成图片   ○ 重新生成文案（需反馈）           ┃ │
│  ┃                                                    ┃ │
│  ┃ 💬 [可选] 给点建议让 AI 改进：                      ┃ │
│  ┃ [文本框 - focus:ring-2 focus:ring-blue-500]       ┃ │
│  ┃                                                    ┃ │
│  ┃ [确认按钮 - 禁用前始终可点击]                       ┃ │
│  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 状态 4: 用户确认后，图片规划生成中

```
┌─────────────────────────────────────────────────────────┐
│ [顶部进度条: 60%] 当前：图片规划                           │
├─────────────────────────────────────────────────────────┤
│  👤 用户: 帮我写一篇关于春游的小红书笔记                    │
│                                                         │
│  ✓ Brief 编译完成 [折叠]                                 │
│  ✓ 研究收集完成 [折叠]                                    │
│  ✓ 文案已生成 [折叠]                                      │
│    └─ 标题：春天就该野一点！… [展开▼]                     │
│                                                         │
│  👤 用户确认: 继续生成图片                                │
│                                                         │
│  ── 🤖 正在规划图片… ──────────────────────────────     │
│                                                         │
│  🖼️ 图片规划 [当前焦点 - ring-2 ring-blue-500]           │
│  ┌───────────────────────────────────────────────────┐ │
│  │ [实时流式输出 - aria-live="polite"]                 │ │
│  │                                                     │ │
│  │ 图1: 樱花特写（封面）                               │ │
│  │ ├─ 风格：小清新，粉色调                            │ │
│  │ ├─ 版式：居中构图，添加文字「春游宝地」             │ │
│  │ └─ 段落映射：标题 + 第1段                          │ │
│  │                                                     │ │
│  │ 图2: 公园全景                                       │ │
│  │ ├─ 风格：广角，绿意盎然                            │ │
│  │ └─ 段落映射：第2-3段（地理位置描述）               │ │
│  │                                                     │ │
│  │ 图3: 游客互动场景                                   │ │
│  │ ├─ 风格：人物特写，温馨氛围                        │ │
│  │ └─ 段落映射：第4-5段（体验分享）                   │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  [自动滚动至此]                                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 状态 5: 图片规划完成，等待 HITL 确认

```
┌─────────────────────────────────────────────────────────┐
│ [顶部进度条: 70%] 等待用户确认                             │
├─────────────────────────────────────────────────────────┤
│  [已完成步骤全部折叠，向上滚动]                            │
│                                                         │
│  ✓ Brief/研究/文案已完成 [折叠组]                         │
│  👤 用户确认: 继续生成图片                                │
│                                                         │
│  ── 🤖 图片规划已完成 ──────────────────────────────    │
│                                                         │
│  🖼️ ImagePlanCard [当前焦点]                             │
│  ┌───────────────────────────────────────────────────┐ │
│  │ [展示完整的 3 张图片规划详情]                        │ │
│  │ （内容同上）                                         │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓ │
│  ┃ 🤖 需要确认 [sticky top-16]                        ┃ │
│  ┃                                                    ┃ │
│  ┃ 图片规划已生成，是否开始生成图片？                  ┃ │
│  ┃                                                    ┃ │
│  ┃ ○ 开始生成   ○ 重新规划（需反馈）                  ┃ │
│  ┃                                                    ┃ │
│  ┃ 💬 调整建议：                                      ┃ │
│  ┃ [文本框]                                           ┃ │
│  ┃                                                    ┃ │
│  ┃ [确认]                                             ┃ │
│  ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 状态 6: 图片生成中（实时进度）

```
┌─────────────────────────────────────────────────────────┐
│ [顶部进度条: 85%] 当前：图片生成 (2/3)                     │
├─────────────────────────────────────────────────────────┤
│  [所有历史步骤折叠]                                       │
│                                                         │
│  ✓ Brief/研究/文案/图片规划已完成 [折叠组]                │
│  👤 用户确认: 开始生成                                    │
│                                                         │
│  ── 🤖 正在生成图片… ──────────────────────────────     │
│                                                         │
│  🖼️ 图片生成进度 [当前焦点 - 实时更新]                    │
│  ┌───────────────────────────────────────────────────┐ │
│  │ [使用 transform: scaleX() 而非 width 动画]          │ │
│  │                                                     │ │
│  │ ✅ 图1: 樱花特写                                    │ │
│  │    [缩略图预览 - loading="lazy"]                    │ │
│  │                                                     │ │
│  │ 🔄 图2: 公园全景 (生成中…)                          │ │
│  │    [进度条 60% - transform: scaleX(0.6)]           │ │
│  │    [Skeleton 占位 - animate-pulse]                 │ │
│  │                                                     │ │
│  │ ⏳ 图3: 游客场景 (排队中…)                          │ │
│  │    [Skeleton 占位]                                  │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  [自动滚动到当前生成项]                                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 状态 7: 图片全部完成，审核评分中

```
┌─────────────────────────────────────────────────────────┐
│ [顶部进度条: 95%] 当前：质量审核                           │
├─────────────────────────────────────────────────────────┤
│  [历史步骤折叠]                                           │
│                                                         │
│  ✓ 前期准备已完成 [折叠组]                                │
│  ✅ 图片全部生成完成                                      │
│                                                         │
│  ── 🤖 正在审核质量… ──────────────────────────────     │
│                                                         │
│  📊 质量评分 [当前焦点 - 流式输出]                        │
│  ┌───────────────────────────────────────────────────┐ │
│  │ [aria-live="polite" - 实时通知]                     │ │
│  │                                                     │ │
│  │ ▸ 信息密度评估…                                     │ │
│  │ ▸ 图文一致性检查…                                   │ │
│  │ ▸ 风格一致性分析…                                   │ │
│  │                                                     │ │
│  │ [加载动画 - transform: rotate()]                    │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 状态 8: 最终交付（100% 完成）

```
┌─────────────────────────────────────────────────────────┐
│ ✅ 创作完成！                                             │
├─────────────────────────────────────────────────────────┤
│  [所有历史折叠，可展开查看]                               │
│                                                         │
│  ── 🎉 最终成果 ────────────────────────────────────   │
│                                                         │
│  📱 小红书笔记预览 [FinalContentCard - 视觉中央]          │
│  ┌───────────────────────────────────────────────────┐ │
│  │ 🖼️ [图1] [图2] [图3]                                │ │
│  │ [可左右滑动预览 - touch-action: manipulation]       │ │
│  │                                                     │ │
│  │ 📝 春天就该野一点！上海周边超适合春游的宝藏公园      │ │
│  │                                                     │ │
│  │ 姐妹们，今天分享一个我偶然发现的春游宝地🌸          │ │
│  │ [完整文案内容]                                       │ │
│  │                                                     │ │
│  │ 🏷️ #春游 #上海周边 #踏青 #顾村公园                 │ │
│  │                                                     │ │
│  │ ─────────────────────────────────                  │ │
│  │                                                     │ │
│  │ 📊 质量评分：85分                                   │ │
│  │ ├─ 信息密度 90 / 图文一致 80                        │ │
│  │ └─ 风格一致 85 / 平台适配 88                        │ │
│  │                                                     │ │
│  │ [快捷操作 - 明确按钮组]                             │ │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐          │ │
│  │ │ 📤 发布  │ │ 💾 保存  │ │ 🔄 重做  │          │ │
│  │ └──────────┘ └──────────┘ └──────────┘          │ │
│  └───────────────────────────────────────────────────┘ │
│                                                         │
│  [展开查看详细过程 ▼]                                    │
│                                                         │
└─ [悬浮输入框] 满意？继续对话或重新生成… ───────────── [发送]
